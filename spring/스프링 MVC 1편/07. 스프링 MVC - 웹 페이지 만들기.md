## 07. 스프링 MVC - 웹 페이지 만들기

----

##### 타임리프 간단히 알아보기

- **타임리프 사용 선언**

  - ```html
    <html xmlns:th="http://www.thymeleaf.org">
    ```

- 속성 변경 - th:href

  - ```html
    // href="value1" 을 th:href="value2" 의 값으로 변경한다.
    // 타임리프 뷰 템플릿을 거치게 되면 원래 값을 th:xxx 값으로 변경한다. 만약 값이 없다면 새로 생성한다.
    th:href="@{/css/bootstrap.min.css}"
    ```

- **타임리프 핵심**

  - 핵심은 th:xxx 가 붙은 부분은 서버사이드에서 렌더링 되고, 기존 것을 대체한다. th:xxx 이 없으면 기존 html의 xxx 속성이 그대로 사용된다.
  - HTML을 파일로 직접 열었을 때, th:xxx 가 있어도 웹 브라우저는 th: 속성을 알지 못하므로 무시한다.
  - 따라서 HTML을 파일 보기를 유지하면서 템플릿 기능도 할 수 있다.

- **URL** **링크 표현식** **- @{...}**,

  - th:href="@{/css/bootstrap.min.css}"
    - @{...} : 타임리프는 URL 링크를 사용하는 경우 @{...} 를 사용한다. 이것을 URL 링크 표현식이라 한다.
    - URL 링크 표현식을 사용하면 서블릿 컨텍스트를 자동으로 포함한다.

- **속성 변경** **- th:onclick**

  - ```html
    onclick="location.href='addForm.html'"
    th:onclick="|location.href='@{/basic/items/add}'|"
    ```

- **리터럴 대체** **- |...|**

  - ```html
    <span th:text="|Welcome to our application, ${user.name}!|">
    ```

- **반복 출력 - th:each**

  - ```html
    <tr th:each="item : ${items}">
    ```

- **변수 표현식** **- ${...}**

  - ```html
    <td th:text="${item.price}">10000</td>
    ```

- **내용 변경** **- th:text**

  - ```html
    <td th:text="${item.price}">10000</td>
    ```

- **속성 변경 - th:value**

  - ```html
    th:value="${item.id}"
    ```

- **URL 링크 표현식2 - @{...}**

  - ```html
    th:href="@{/basic/items/{itemId}(itemId=${item.id})}"
    ```

- **URL** **링크 간단히**

  - ```html
    th:href="@{|/basic/items/${item.id}|}"
    ```

----

>HTML Form 전송은 PUT, PATCH를 지원하지 않는다. GET, POST만 사용할 수 있다.
>PUT, PATCH는 HTTP API 전송시에 사용
>스프링에서 HTTP POST로 Form 요청할 때 히든 필드를 통해서 PUT, PATCH 매핑을 사용하는 방법이 있지만, HTTP 요청상 POST 요청이다.



##### PRG Post/Redirect/Get

- POST 등록 후 새로 고침

  - 웹 브라우저의 새로 고침은 마지막에 서버에 전송한 데이터를 다시 전송한다.
    새로 고침 문제를 해결하려면 상품 저장 후에 뷰 템플릿으로 이동하는 것이 아니라, 상품 상세 화면으로 리다이렉트를 호출해주면 된다.
    웹 브라우저는 리다이렉트의 영향으로 상품 저장 후에 실제 상품 상세 화면으로 다시 이동한다. 
    따라서 마지막에 호출한 내용이 상품 상세 화면인 GET /items/{id} 가 되는 것이다.
    이후 새로고침을 해도 상품 상세 화면으로 이동하게 되므로 새로 고침 문제를 해결할 수 있다.
    이런 문제 해결 방식을 PRG Post/Redirect/Get 라 한다.

  - >"redirect:/basic/items/" + item.getId() redirect에서 +item.getId() 처럼 URL에 변수를 더해서 사용하는 것은 
    >URL 인코딩이 안되기 때문에 위험하다.

  ```java
  @PostMapping("/add")
  public String addItemV6(Item item, RedirectAttributes redirectAttributes) {
          Item savedItem = itemRepository.save(item);
          redirectAttributes.addAttribute("itemId", savedItem.getId());
          redirectAttributes.addAttribute("status", true);
          return "redirect:/basic/items/{itemId}";
  }
  ```
