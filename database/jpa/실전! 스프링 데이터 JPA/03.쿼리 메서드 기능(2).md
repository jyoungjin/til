## 03. 쿼리 메서드 기능(2)

----

##### @EntityGraph

- ```java
  // 1. 공통 메서드 오버라이드
  @Override
  @EntityGraph(attributePaths = {"team"})
  List<Member> findAll();
  
  // 2. JPQL + 엔티티 그래프
  @EntityGraph(attributePaths = {"team"})
  @Query("select m from Member m")
  List<Member> findMemberEntityGraph();
  
  // 3. 메서드 이름으로 쿼리에서 특히 편리하다.
  @EntityGraph(attributePaths = {"team"})
  List<Member> findEntityGraphByUsername(@Param("username") String username);
  ```

- 사실상 페치 조인(FETCH JOIN)의 간편 버전

- LEFT OUTER JOIN 사용

- **간단할 경우에는 EntityGraph를 쓰고 복잡할 경우에는 JPQL에서 fetch join을 사용하여 해결한다.**

----

##### JPA Hint & Lock

JPA Hint

- JPA 쿼리 힌트 ( SQL 힌트가 아니라 JPA 구현체에게 제공하는 힌트 )

- ```java
  @QueryHints(value = @QueryHint(name = "org.hibernate.readOnly", value = "true"))
  Member findReadOnlyByUsername(String username);
  ```

- option을 read-only로 설정하면 스냅샷을 저장하지 않아 변경 감지를 하지 않는다. ( 성능상 이점 )



JPA Lock

- ```java
  @Lock(LockModeType.PESSIMISTIC_WRITE)
  List<Member> findLockByUsername(String username);
  ```

- 비관적 잠금 ( Pessimistic Lock )
  - 선점 잠금이라고 불리기도 함
  - 트랜잭션끼리의 충돌이 발생한다고 가정하고 우선 락을 거는 방법
  - DB에서 제공하는 락 기능을 사용
- LockMode 종류
  - PESSIMISTIC_WRITE
    - 일반적인 옵션으로 다른 트랜잭션에서 읽기도 쓰기도 못함
  - PESSIMISTIC_READ
    - 반복 읽기만 하고 수정하지 않는 용도로 락을 걸때 사용
    - 다른 트랜잭션에서 읽기는 가능
  - PESSIMISTIC_FORCE_INCREMENT
    - Version 정보를 사용하는 비관적 락
