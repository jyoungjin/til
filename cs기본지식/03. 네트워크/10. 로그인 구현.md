## 로그인 구현

---

##### #1. 세션기반 인증 방식

- 로그인은 **세션기반 인증방식** 또는 **토큰기반 인증방식**으로 구현
- HTTP의 특징 중 하나는 상태없음(stateless)하다 라는 것인데, 
  즉, HTTP 요청을 통해 데이터를 주고 받을 때 요청이 끝나면 요청한 사용자의 정보 등을 유지하지 않는 특징이 있습니다.
- 세션: 서버와 클라이언트의 연결이 활성화된 상태를 의미합니다.
- 세션ID: 웹 서버 또는 DB에 저장되는 클라이언트에 대한 유니크한 ID
- 세션기반 로그인 프로세스
  1. 처음 로그인 >> 세션ID가 생성 >> 서버에서 세션ID를 쿠키로 설정해서 클라이언트에 전달
  2. 클라이언트가 서버에 요청을 보낼 때 해당 세션ID를 쿠키로 담아서 전에 로그인했던 아이디인지 확인
  3. 로그인을 유지
- 단점
  1. 사용자의 상태에 관한 데이터를 서버에 저장했을 때 로그인 중인 유저의 수가 늘어난다면 서버의 메모리 과부화가 일어날 수 있습니다.
  2. DB 중 RDBMS에 저장한다면 직렬화 및 역직렬화에 관한 오버헤드가 발생합니다.



##### #2. 토큰기반 인증방식

- 토큰기반 인증방식은 인증은 토큰기반 인증서버를 통해 하고 다른 컨텐츠를 주는 서버는 stateless하게 내버려두자는 이론이 담겨있는 인증방식입니다. 토큰은 주로 JWT토큰이 활용됩니다.
  1. 인증로직 >> JWT토큰생성 (access 토큰, refresh 토큰)
  2. 사용자가 이후에 access 토큰을 HTTP Header - Authorization 또는 HTTP Header - Cookie에 담아 인증이 필요한 서버에 요청해 원하는 컨텐츠를 가져옵니다.
- JWT (JSON Web Token)
  - JWT는 **헤더, 페이로드, 서명**으로 이루어져 있으며 JSON 객체로 인코딩되며 메시지 인증, 암호화에 사용됩니다.
  - Header
    - 어떠한 방법의 서명 알고리즘을 사용할 것인가에 대한 정보.
  - Payload
    - 데이터, 토큰 발급자, 토큰 유효시간
  - Signature
    - 헤더에 정의된 알고리즘으로 인코딩된 header + 인코딩된 payload + 비밀키(secret key)를 기반으로 생성된 서명값
- 장점
  1. 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 별도의 인증 저장소가 필요 없습니다.
  2. 다른 유형의 토큰과 비교했을 때 경량화 되어 있습니다. 
     SAML(Security Assertion Markup Language Tokens)이란 토큰이 있지만 이에 비해 훨씬 경량화되어있음.
  3. 디코딩했을 때 JSON이 나오기 때문에 JSON을 기반으로 쉽게 직렬화, 역직렬화가 가능하다.
- 단점
  1. 토큰이 비대해질 경우 당연히 서버 과부화에 영향을 줄 수 있습니다.
  2. 토큰을 탈취당할 경우 디코딩했을 때 데이터를 볼 수 있습니다.



##### #3. 토큰기반인증방식(access토큰, refresh토큰) 실습

- 토큰기반인증방식을 구현할 때는 refresh토큰과 access토큰 두개를 기반으로 구현합니다. access토큰의 수명은 짧게, refresh토큰의 수명은 길게 합니다.
- refresh토큰은 access토큰이 만료되었을 때 다시 access 토큰을 얻기 위해 사용되는 토큰입니다. 이를 통해 access토큰이 만료됬을 때마다 인증에 관한 비용이 줄어들게 됩니다. 로그인을 하게 되면 access 토큰과 refresh 토큰 두개를 얻습니다.
- 그 다음 access 토큰이 만료가 되거나 사용자가 새로고침을 할 때 refresh토큰을 기반으로 새로운 access token을 얻습니다.
- 주의할 점
  - 이렇게 access토큰을 얻었다면 그 이후에 요청을 할 때는 HTTP Header - Authorization 또는 HTTP Header - Cookie에 담아 요청을 하게 되는데요. 이 때 다음과 같은 규칙을 지키는 것이 좋습니다.
    - Bearer <token> 으로 Bearer 을 앞에 둬서 토큰기반인증방식이라는 것을 알려주어야 합니다.
    - https를 사용해야 합니다.
    - 쿠키에 저장한다면 sameSite: 'Strict'을 써야 합니다.
    - 수명이 짧은 access token을 발급해야 합니다.
    - url에 토큰을 전달하지 말아야 합니다.
  - 참고로 이러한 점들은 OAuth2.0과 JWT에 관한 표준문서인 RFC 6750, RFC7519를 기반으로 설명합니다.
